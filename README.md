#### Глава 1 Разработка приложения для ведения блога
В главе рассказывается про установку python, активацию виртуального окружения и подключение вэб-фреимворка django.

- Базовые команды для создания проекта, применение миграций, старт приложения, создание суперпользователя.
- Создание моделей и миграций. Поля для моделей в аднминке. Такие как отображаемые поля, фильтры, поиск и другие.
- габлонные тэги, фильтры и переменные

Рассказывается как с помощью шаблонного тега подключать стили css.


#### Глава 2 Усовершенствование блога за счет продвинутых функциональностей
В главе рассказывается про установку канонического url адреса. Постраничная разбивка Paginator. 
Настроили отправку писем. Добавили переменные в .env.

Пример абсолютного пути для конкретного поста
```python file:views.ru
# ...
from django.urls import reverse


class Post(models.Model):
    # ...

	def get_absolute_url(self):
	return reverse(
		"blog:post_detail",
		args=[
			self.publish.year,
			self.publish.month,
			self.publish.day,
			self.slug,
		],
	)

#...
```
Теперь в шаблонах можно использовать абсолютный путь, что упрощает поддержку приложения
```DjangoHTML
<!-- .... -->
{{ post.get_absolute_url }}
<!-- .... -->
```


#### Глава 3 Расширение приложения для ведения блога
Добавили Тэги для постов. 
##### Вывод тегов в шаблоне и добавление ссылки

```DjangoHTML

{{ post.tags.all|join:", "}} собираем все теги

```

 Научились выводиь список всех постов помеченных определенным тегом.
 Научились извлекать и рекомендовать похожие посты.

 ##### Создание шаблонных тэгов.
- simple_tag - обрабатывает предоставленные данные и возвращает строковый литерал
- inclusion_tag -  обрабатывает предоставленные данные и возвращает прорисованный шаблон. 

##### Создание новостных лент для постов блога
В Django есть фреймворк синдицированных новостных лент. На которые можно подписаться с помощью специальных программ и использовать для динамического формирования новостных лент RSS или Atom-лент. Отправляются обычно в формате XML.

##### Добавление полнотекстового поиска в блог
Встроенный в Django ORM-преобразователь позволяет выполнять простые операции по сопоставлению. Для более сложного поиска необходимо задействовать полнотекстовый поисковый механизм. Django предоставляет мощную функциональность по поиску в базе данных Postgres. Модуль django.contrib.postgres

##### Установка базы данных PosgtresSQL
Для работы с базой данных необходимо установить адаптер psycopg2-binary.

##### Создание базы данных PostgreSQL
Создание базы данных, пользователя, выгрузка данных из sqlite и загрузка в Postgres.
Переключение базы данных в settings.py

Подключаемся к базе
```Shell
psql -U postgres
# для себя сделал alias и подключаюсь по psql
```

Создаем пользователя
```Shell
CREATE USER blog WITH PASSWORD '222462';
```
При успешном создании выведется результат CREATE ROLE

Создание базы данных
```Shell
CREATE DATABASE blog OWNER blog ENCODING 'UTF8';
# Вслучае возникновения ошибки можно воспользоваться командой 
# CREATE DATABASE blog OWNER blog ENCODING 'UTF8' TEMPLATE template0;
```
При успешном создании выведется CREATE DATABASE


##### Выгрузка существующих данных
Django предлагает простой способ выгрузки данных в фикстуры. Поддерживает форматы JSON, XML, YAML.
Выгружается командой dumpdata. Можно передавать отдельные флаги. indent - отступы, output - указывает выходной файл. 
Можно отдельно выгружать модели используя формат app.Model
```Shell
python manage.py dumpdata --indent=2 --output=mysite_data.json
```

###### Загрузка данных в новую базу данных
```Shell
python manage.py loaddata mysite_data.json
```

##### Операции для поиска.
Разбаботали поиск по полям. Создали форму и шаблон для поиска.

##### Выделение основ слов и ранжирование результатов
Поисковая система слова music, musical и musicality может считать похожими. Django предоставляет класс SearchQuery, чтобы транслировать термины в объект поискового запроса и пропускает через базовые определения основ слов. 

##### Выделение основ слов и удаление стоп-слов на разных языках
Необходимо в SearchVector и Search-Query передать атрибут config

##### Взвешивание запросов
Можно усиливать влияние конкретных векторов. Например большую релевантность постов которые сочетаются по заголовкам.

##### Поиск по триграммному сходству
Триграмма - это группа трех следующих друг за другом символов. 
Чтобы использовать необходимо добавить в триграммы в PostgreSQL

#### Глава 4 Разработка социального веб-сайта

В этой главе рассмотрены следующие темы:
- Создание представления входа в систему
- Использование встроенного метода аутентификации
- Создание шаблонов представления для входа, выходи, смены и сброса пароля
- Расширение модели пользователя с помощью конкретно-прикладной модели профиля
- Создание представлений регистрации пользователя
- Конфигурирование проекта под закачивание медиафайлов на сайт
- использование фреймворка сообщений
- разработка конкретно-прикладного бэкенда для аутентификации
- Запрет на использование пользователями существующей электронной почты

##### Создание проекта социально вэб-сайта
Разрабатываем сайт с системой аутентификацией, подпиской, шарингом изображений и поток активности.
Создаем проект bookmarks и приложение account
Подключим установленное приложение. Самым первым. Тем самым мы переопределим стандартные шаблоны аунтефикации django.contrib.admin

##### Использование поставляемого с Django фреймворка аутентификации
Django поставляется со встроенным фреймворком аутентификации. Содержит представления обычных действий пользователя. Вход, выход, сброс пароля, смена пароля.
При создании проекта фреймворк встраивается в стандартные настройки проекта. Состоит из django.contrib.auth и двух промежуточных классов, которые находятся в MIDDLEWARE.
- AuthenticationMiddleware: ассоциирует пользователей с запросами с помощью сеансов.
- SessionMiddleware: оперирует текущим сеансов во всех запросах.
Фреймворк аутентификации содержит следующие модели django.contrib.auth.models:
- User: модель пользователя с базовыми полями. username, password, email, first_name, last_name, is_active
- Group: модель группы для отнесения к категориям.
- Permission: флаги для пользователей или групп для выполнения ими определенных действий

#### Создание представления входа в систему
Создаем представление, которое будет выполнять следующие действия:
- Показывать форму входа
- Получать имя и пароль
- Аутентифицировать пользователя
- Проверять, что пользователь активен
- Регистрировать вход пользователя в систему.

Когда пользователь передает запрос методом POST выполняются следующие действия:
- Создается экземпляр формы.
- Форма проверяется на валидность или выводится сообщение
- Если передаваемые на обработку валидны, то пользователь аутентифицируется по базе данных методом authenticate() в него передается username и password и возвращается объект User. Если пользователь не аутентифицирован возвращается ответ.
- Проверяется активен ли пользователь.
- Если пользователь активен, то входит в систему

##### Использование встроенных в Django представлений аутентификации
В Django содержится несколько форм и представлений для аутентификации. В большинстве случаев их можно использовать.
- LoginView - оперирует формой входа и регистрирует вход пользователей
- LogoutView - регистрирует выход пользователя
- PasswordChangeView - смена пароля
- PasswordChangeDoneView - успех при смене пароля, перенаправление на страницу
- PasswordResetView - сброс пароля
- PasswordResetDoneView - отправляет письмо со ссылкой для сброса пароля
- PasswordResetConfirmView - позволяет устанавливать пароль
- PassworfResetCompleteVIew - представление страницы об успехе


- LOGIN_REDIRECT_URL: сообщает Django на какой адрес перенаправлять, в случае успешного входа
- LOGIN_URL: адрес на который следуют перенаправлять для регистрации входа пользователя
- LOGOUT_URL: адрес на который следует перенаправлять, что зарегистрировать выход пользователя

##### Регистрация пользователей и профили пользователей
Создаем форму для регистрации пользователя. Форма содержит поля username, first_name, email. 
Данные поля будут валидироваться в соответствии с проверками на валидность соответствующих полей модели. 
Например, если пользовательское имя уже существует, то при регистрации пользователь получит ошибку валидации, так у модели User username = uniq=True

Добавим валидацию для дополнительных полей password и password2, для того чтобы пользователи могли устанавливать пароль и проверять его. 
```python file:forms.py
# ...
    def clean_password2(self):
        cd = self.cleaned_data
        if cd["password"] != cd["password2"]:
            raise forms.ValidationError("Passwords don't match")
        return cd["password2"]
#...
```

Представление создания учетных записей. UserCreationForm
Для безопасности  вместо сохранения пароля используется метод set_password(). Данный метод хеширует пароль перед сохранением в базу данных. 
По умолчанию используется алгоритм хеширования PBKDF2 с хешем SHA256. 
Django поддерживает проверку существующих паролей с помощью алгоритма PBKDF2, но так же поддерживает проверку и других алгоритмов PBKDF2SHA1, argon2, bcrypt и scrypt.
Надстроечный параметр PASSWORD_HASHERS определяет хешеры паролей.

Список хешеров паролей PASSWORD_HASHERS:

```python file:settings.py
# ...
PASSWORD_HASHERS = [
    "django.contrib.auth.hashers.PBKDF2PasswordHasher",
    "django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher",
    "django.contrib.auth.hashers.Argon2PasswordHasher",
    "django.contrib.auth.hashers.BCryptSHA256PasswordHasher",
    "django.contrib.auth.hashers.ScryptPasswordHasher",
]
#...
```

##### Расширение модели пользователя
Создан профиль для пользователя с возможностью редактирования своего профиля. 

Стандартная модель User идет в комплекте с ограниченным набором полей. Её можно расширить. 
В целях поддержания обобщенного характера исходного кода следует использовать метод get_user_model(), который позволяет извлекать модель пользователя и настроечный параметр AUTH_USER_MODEL, чтобы ссылаться на него при определении модели с моделью пользователя. Не ссылаясь на модель пользователя auth напрямую. 

```python 
# ... использование get_user_model()
user = models.OneToOneField(get_user_model(), on_delete=models.CASCADE)
#...
```

##### Установка библиотеки Pillow и раздача медиафайлов
Для работы с изображениями необходимо установить библиотеку Pillow. 
Pillow требуется веб-фреймворку Django для работы с изображениями в классе ImageField.

Установка
```Shell
uv add pillow
```

Добавление базового пути и локального адреса
```python file:settings.py
# ...
MEDIA_URL = "media/"
MEDIA_ROOT = BASE_DIR / "media"
#...
```

Добавление раздачи статических файлов во время вэб разработки
```python file:name
# ...
from django.conf import settings
from django.conf.urls.static import static

#...
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

Создание форм:
- UserEditForm позволяет редактировать пользователям свои имя, фамилию, почту.
- ProfileEditForm позволяет редактировать день рождение и фото.

Добавление декоратора @login_required, чтобы только аутентифицированные пользователи могли редактировать свои профили.

##### Использование фреймворка сообщений
Django имеет встроенный фреймворк сообщений, который позволяет показывать одноразовые уведомления пользователям. Входит в стандартный список приложений при создании нового проекта (django.contrib.messages). Также есть промежуточные компоненты (django.cintrib.messages.middleware).
По умолчанию сообщения хранятся в cookie-файле. Фреймворк можно использовать в своих представлениях.

Методы для создания сообщений
- add_messages()
- info()
- warning()
- error()
- debug()

Фреймворк сообщений содержит процессор контекста (django.contrib.messages.context_processors.messages), который добавляет переменную messages в контекст.

##### Разработка конкретно-прикладного бэкенда аутентификации
Django позволяет аутентифицировать пользователей по различным источникам. По умолчанию django.contrib.auth.backends.ModelBackend - аутентификация по базе данных используя модель User.

Можно создавать свои конкретно-прикладные бэкенды. Например LDAP.
Бэкенд аутентификации это класс содержаний два метода:
- authenticate() - принимает объект request и учетные данные пользователя. 
- get_user() - принимает ИД пользователя и возвращает объект user

##### Предотвращение использования существующего адреса электронной почты
Добавление в форму регистрации метода clean_email. Для предотвращения регистрации пользователей с одинаковыми email.

